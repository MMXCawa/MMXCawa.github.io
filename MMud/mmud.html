<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>Minecraft 文字冒险游戏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        .container {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .button {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px 0;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
        }
        .button:hover {
            background-color: #45a049;
        }
        .console {
            background-color: #333;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .console.error {
            color: red;
        }
        .console.debug {
            color: gray;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Minecraft 文字冒险游戏</h1>
        <div id="storyContainer">
            <p id="story">点击加载按钮以开始游戏。</p>
        </div>
        <div id="choices"></div>
        <div id="inventory">
            <h3>物品栏</h3>
            <p id="items"></p>
        </div>
        <div id="save">
            <button class="button" onclick="saveGame()">保存存档</button>
            <input type="file" id="loadFile" />
            <button class="button" onclick="loadGame()">读取存档</button>
        </div>
        <button class="button" onclick="loadGameFiles()">加载游戏</button>
        <div id="console" class="console"></div>
    </div>

    <script>
        // 玩家属性
        var playerAttributes = {
            health: 100
        };

        // 当前选择
        var currentChoice = 0;

        // 初始化物品栏
        var inventory = {};

        // 加载文件
        function loadGameFiles() {
            fetch('items.list')
                .then(response => response.json())
                .then(data => {
                    inventory = data;
                    updateInventory();
                    logToConsole('items.list加载成功', 'debug');
                })
                .catch(error => logToConsole('items.list加载失败：' + error, 'error'));

            fetch('events.json')
                .then(response => response.json())
                .then(data => {
                    events = data;
                    logToConsole('events.json加载成功', 'debug');
                    startGame();
                })
                .catch(error => logToConsole('events.json加载失败：' + error, 'error'));
        }

        // 更新物品栏显示
        function updateInventory() {
            var items = document.getElementById('items');
            items.innerHTML = '';
            for (var key in inventory) {
                if (inventory.hasOwnProperty(key)) {
                    var item = inventory[key];
                    items.innerHTML += `<p>${item.name}: ${item.quantity}</p>`;
                }
            }
        }

        // 保存游戏
        function saveGame() {
            var saveData = {
                currentChoice: currentChoice,
                inventory: inventory,
                playerAttributes: playerAttributes
            };
            var saveDataStr = JSON.stringify(saveData);
            var blob = new Blob([saveDataStr], { type: "text/plain;charset=utf-8" });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'save.mxher07save';
            a.click();
            URL.revokeObjectURL(url);
            logToConsole('游戏已保存', 'debug');
        }

        // 读取游戏
        function loadGame() {
            var fileInput = document.getElementById('loadFile');
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var saveData = JSON.parse(event.target.result);
                currentChoice = saveData.currentChoice;
                inventory = saveData.inventory;
                playerAttributes = saveData.playerAttributes;
                updateInventory();
                choose(currentChoice);
                logToConsole('存档已加载', 'debug');
            };
            reader.readAsText(file);
        }

        // 事件处理函数
        function choose(option) {
            currentChoice = option;
            var story = document.getElementById('story');
            var choices = document.getElementById('choices');

            if (option === 1) {
                story.innerHTML = "你走进了茂密的森林，手中握着木斧，开始砍伐树木。每次砍下一块树木，你都能收集到一些木材。渐渐地，你收集了足够的木材来建造一个简单的庇护所。";
                inventory.wood.quantity += 20;
                updateInventory();
                logToConsole('玩家执行了选择：砍树收集木材', 'debug');
                choices.innerHTML = `
                    <button class="button" onclick="choose(5)">建造一个简易的庇护所</button>
                    <button class="button" onclick="choose(6)">继续收集更多木材</button>
                    <button class="button" onclick="choose(7)">探索森林深处，寻找更多资源</button>
                    <button class="button" onclick="choose(8)">返回原地，计划下一步行动</button>
                `;
            } else if (option === 2) {
                story.innerHTML = "你发现了一座山洞，里面似乎隐藏着许多资源，但也可能有危险。";
                logToConsole('玩家执行了选择：探索附近的山洞', 'debug');
                choices.innerHTML = `
                    <button class="button" onclick="choose(9)">进入山洞</button>
                    <button class="button" onclick="choose(10)">返回原地</button>
                `;
            } else if (option === 3) {
                story.innerHTML = "你开始建造一个简易的庇护所，确保在夜晚来临前有地方躲避怪物。";
                logToConsole('玩家执行了选择：建造一个简易的庇护所', 'debug');
                choices.innerHTML = `
                    <button class="button" onclick="choose(11)">继续建造庇护所</button>
                    <button class="button" onclick="choose(12)">休息一会儿</button>
                `;
            } else if (option === 4) {
                story.innerHTML = "你向湖泊进发，湖水清澈见底，周围有许多野生动物。";
                logToConsole('玩家执行了选择：向湖泊进发', 'debug');
                choices.innerHTML = `
                    <button class="button" onclick="choose(13)">在湖边扎营</button>
                    <button class="button" onclick="choose(14)">继续探索湖泊周围</button>
                `;
            }
        }

        // 读取并触发事件
        function triggerEvent(eventName) {
            fetch('events.json')
                .then(response => response.json())
                .then(data => {
                    var event = data[eventName];
                    if (event.options.length > 6) {
                        logToConsole('Error: Event ' + eventName + ' options cannot > 6', 'error');
                        return;
                    }
                    document.getElementById('story').innerHTML = event.description;
                    var choicesHTML = '';
                    event.options.forEach(option => {
                        choicesHTML += `<button class="button" onclick="triggerEvent('${option.action}')">${option.text}</button>`;
                    });
                    document.getElementById('choices').innerHTML = choicesHTML;

                    // 处理事件效果
                    if (event.effects) {
                        if (event.effects.addItems) {
                            for (var addItem in event.effects.addItems) {
                                inventory[addItem].quantity += event.effects.addItems[addItem];
                            }
                        }
                        if (event.effects.removeItems) {
                            for (var removeItem in event.effects.removeItems) {
                                inventory[removeItem].quantity -= event.effects.removeItems[removeItem];
                            }
                        }
                        if (event.effects.playerAttributes) {
                            for (var attribute in event.effects.playerAttributes) {
                                playerAttributes[attribute] += event.effects.playerAttributes[attribute];
                            }
                        }
                        updateInventory();
                    }
                    logToConsole('玩家执行了事件：' + eventName, 'debug');
                })
                .catch(error => logToConsole('Error: ' + error, 'error'));
        }

function logToConsole(message, type) {
            var consoleDiv = document.getElementById('console');
            var messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            if (type === 'error') {
                messageDiv.className = 'console error';
            } else if (type === 'debug') {
                messageDiv.className = 'console debug';
            }
            consoleDiv.appendChild(messageDiv);
        }

        // 初始化游戏
        function startGame() {
            document.getElementById('story').innerHTML = "你进入了一个新的Minecraft世界。周围是茂密的森林，远处可以看到高耸的山脉，还有一个闪闪发光的湖泊。你的背包里有一些基本的物资：木斧、木镐和几块面包。";
            var choicesHTML = `
                <button class="button" onclick="choose(1)">砍树收集木材</button>
                <button class="button" onclick="choose(2)">探索附近的山洞</button>
                <button class="button" onclick="choose(3)">建造一个简易的庇护所</button>
                <button class="button" onclick="choose(4)">向湖泊进发</button>
            `;
            document.getElementById('choices').innerHTML = choicesHTML;
        }
    </script>
</body>
</html>